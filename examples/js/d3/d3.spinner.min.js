function spinner(e){function o(e){s=e;e.each(function(e,t){var s=d3.select(this).append("g").attr("class","spinner").attr("current",0);for(var t=0;t<n.steps;t++){var o=[{x:n.width/2+d3.tools.polarToCartesian(r*t*2,n.radius/2*n.inner_radius)[0],y:n.height/2+d3.tools.polarToCartesian(r*t*2,n.radius/2*n.inner_radius)[1]},{x:n.width/2+d3.tools.polarToCartesian(r*t*2,n.radius/2)[0],y:n.height/2+d3.tools.polarToCartesian(r*t*2,n.radius/2)[1]},{x:n.width/2+d3.tools.polarToCartesian(r*(t*2+1),n.radius/2)[0],y:n.height/2+d3.tools.polarToCartesian(r*(t*2+1),n.radius/2)[1]},{x:n.width/2+d3.tools.polarToCartesian(r*(t*2+1),n.radius/2*n.inner_radius)[0],y:n.height/2+d3.tools.polarToCartesian(r*(t*2+1),n.radius/2*n.inner_radius)[1]},{x:n.width/2+d3.tools.polarToCartesian(r*t*2,n.radius/2*n.inner_radius)[0],y:n.height/2+d3.tools.polarToCartesian(r*t*2,n.radius/2*n.inner_radius)[1]}];s.append("path").attr("class",n.cls+" step_"+t).attr("d",i(o))}});interval=setInterval(function(){o.update()},n.time)}var t={height:50,width:50,steps:15,inner_radius:.7,tail:!0,time:100,radius:50,cls:"spinner-step"},n=d3.tools.extend(t,e),r=360/(n.steps*2)/180*Math.PI,i=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");n.radius=n.height>n.width?n.width:n.height;var s;o.update=function(){s.each(function(e,t){var r=d3.select(this),i=r.select(".spinner").attr("current");for(var t=0;t<n.steps;t++)t!=i?r.select(".step_"+t).attr("class",n.cls+" step_"+t):d3.tools.addClass(r.select(".step_"+t),"active");if(n.tail)for(var t=1;t<5;t++){var s=i-t;s<0&&(s+=n.steps);d3.tools.addClass(r.select(".step_"+s),"active-"+t)}i++;i>=n.steps&&(i=0);r.select(".spinner").attr("current",i)})};o.destroy=function(){clearInterval(interval)};return o};